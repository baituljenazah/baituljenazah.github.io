<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pembayaran - Pengurusan Jenazah Islam</title>

<style>
/* ===== DESIGN KEKAL (TAK SENTUH) ===== */
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;line-height:1.6;color:#333;background:#f5f5f5}
header{background:#008000;color:white;padding:1rem 0;box-shadow:0 2px 5px rgba(0,0,0,.1)}
.container{max-width:1200px;margin:0 auto;padding:0 20px}
.logo{font-size:1.5rem;font-weight:bold;text-align:center}
.back-link{display:inline-block;color:white;text-decoration:none;margin-top:.5rem}
.payment-container{display:grid;grid-template-columns:1fr 400px;gap:2rem;margin:3rem auto;max-width:1200px;padding:0 20px}
.payment-form-section,.order-summary{background:white;padding:2rem;border-radius:10px;box-shadow:0 3px 10px rgba(0,0,0,.1)}
h2{color:#008000;margin-bottom:1.5rem;border-bottom:2px solid #008000;padding-bottom:.5rem}
.form-group{margin-bottom:1.5rem}
.form-group label{display:block;margin-bottom:.5rem;font-weight:500}
.form-group input,.form-group textarea,.form-group select{width:100%;padding:12px;border:1px solid #ddd;border-radius:5px}
.payment-methods{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;margin-bottom:1.5rem}
.payment-method{border:2px solid #ddd;padding:1rem;text-align:center;cursor:pointer;border-radius:5px}
.payment-method.active{border-color:#008000;background:#f0fff0}
.btn{padding:12px;background:#008000;color:white;border:none;border-radius:5px;font-weight:bold;width:100%;cursor:pointer}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);justify-content:center;align-items:center}
.modal.active{display:flex}
.modal-content{background:white;padding:3rem;border-radius:10px;text-align:center}
</style>
</head>

<body>

<header>
<div class="container">
<div class="logo">‚ò™ Pengurusan Jenazah Islam</div>
<a href="index.html" class="back-link">‚Üê Kembali ke Katalog</a>
</div>
</header>

<div class="payment-container" id="payment-container"></div>

<div class="modal" id="success-modal">
<div class="modal-content">
<div style="font-size:4rem;color:#008000">‚úì</div>
<h2>Pembayaran Berjaya!</h2>
<p>Nombor rujukan: <strong id="ref-number"></strong></p>
<p id="firebase-save-status" style="margin-top:1rem;color:#008000"></p>
<button class="btn" onclick="completeOrder()">Selesai</button>
</div>
</div>

<!-- ===== FIREBASE (AUTO CONNECT) ===== -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

/* üî• FIREBASE CONFIG KAU */
const firebaseConfig = {
  apiKey: "AIzaSyCg-PTA6OtwvCRk8BmykVZD90jWhaYZD_I",
  authDomain: "assignment-b40bf.firebaseapp.com",
  projectId: "assignment-b40bf",
  storageBucket: "assignment-b40bf.firebasestorage.app",
  messagingSenderId: "560597458410",
  appId: "1:560597458410:web:60287c40fda7d6f6bae693"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ===== APP LOGIC ===== */
let cart = [];
let currentPaymentMethod = "card";

window.onload = () => {
  const saved = localStorage.getItem("jenazahCart");
  if(saved) cart = JSON.parse(saved);
  renderPage();
};

function renderPage(){
  const container = document.getElementById("payment-container");
  if(cart.length === 0){
    container.innerHTML = "<h2>Troli Kosong</h2>";
    return;
  }

  const total = cart.reduce((a,b)=>a+b.price,0);

  container.innerHTML = `
  <div class="payment-form-section">
    <h2>Maklumat Pelanggan</h2>
    <form onsubmit="processPayment(event)">
      <div class="form-group">
        <label>Nama</label>
        <input id="fullname" required>
      </div>
      <div class="form-group">
        <label>Telefon</label>
        <input id="phone" required>
      </div>
      <div class="form-group">
        <label>Email</label>
        <input id="email" type="email" required>
      </div>
      <div class="form-group">
        <label>Alamat</label>
        <textarea id="address" required></textarea>
      </div>
      <button class="btn">Bayar RM ${total}</button>
    </form>
  </div>

  <div class="order-summary">
    <h2>Ringkasan</h2>
    ${cart.map(i=>`<p>${i.name} - RM ${i.price}</p>`).join("")}
    <hr>
    <strong>Jumlah: RM ${total}</strong>
  </div>`;
}

window.processPayment = async (e) => {
  e.preventDefault();

  const ref = "JNZ" + Date.now();

  const data = {
    reference: ref,
    name: fullname.value,
    phone: phone.value,
    email: email.value,
    address: address.value,
    cart,
    total: cart.reduce((a,b)=>a+b.price,0),
    status: "Completed",
    createdAt: new Date()
  };

  await addDoc(collection(db,"pembayaran"), data);

  document.getElementById("ref-number").textContent = ref;
  document.getElementById("firebase-save-status").textContent = "‚úì Data berjaya disimpan ke Firestore";
  document.getElementById("success-modal").classList.add("active");
};

window.completeOrder = () => {
  localStorage.removeItem("jenazahCart");
  window.location.href = "index.html";
};
</script>

</body>
</html>
